<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="overlay" onclick="closeNav()"></div>
    <div id="toast"></div>

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">ğŸ“Š Dashboard</a>
        <a href="profile.html">ğŸ‘¤ User Profile</a>
        <a href="diet.html">ğŸ Diet Tracker</a>
        <a href="walking.html">ğŸ‘£ Walking</a>
        <a href="water.html" style="color: #6ab3f8;">ğŸ’§ Water Tracker</a>
        <a href="sedentary.html">ğŸª‘ Sedentary Timer</a>
        <a href="stairs.html">ğŸªœ Stairs Tracker</a>
        <a href="sleep.html">ğŸ˜´ Sleep Manager</a>
        <a href="exercise.html">ğŸƒ Exercise</a>
    </div>

    <div class="header-bar">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
    </div>

    <div class="container" style="margin-top: 0;">
        <h2>ğŸ’§ Water Tracker</h2>
        <p style="text-align:center; color:#666;">Goal: <span id="goal-display">2000</span> mL</p>

        <div class="cup-container">
            <div class="cup">
                <div class="remained" id="remained">
                    <span id="liters"></span>
                    <small>Remained</small>
                </div>
                <div class="water" id="cupWater" style="height: 0%;"></div>
            </div>
        </div>
        
        <div style="text-align:center; font-weight:bold; margin-bottom:15px; font-size:1.2em; color:#4a90e2;" id="progressText">0%</div>

        <div class="card">
            <h3>Quick Add</h3>
            <div class="cups">
                <div class="cup-small" onclick="addWater(250)">250 ml</div>
                <div class="cup-small" onclick="addWater(500)">500 ml</div>
            </div>
            
            <div style="margin-top:15px; display:flex; gap:10px;">
                <input type="number" id="custom-amount" placeholder="Custom mL" style="margin:0;">
                <button class="primary-btn" onclick="addCustomWater()">Add</button>
            </div>
        </div>

        <div class="card">
            <h3>Today's History</h3>
            <div id="water-log" style="max-height:150px; overflow-y:auto;"></div>
            <button class="danger-btn small" onclick="resetWater()" style="width:100%; margin-top:10px;">Reset Day</button>
        </div>
    </div>

    <script>
        function openNav() { document.getElementById("mySidenav").style.width = "250px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidenav").style.width = "0"; document.getElementById("overlay").style.display = "none"; }
        function showToast(msg) { const t=document.getElementById('toast'); t.textContent=msg; t.className="show"; setTimeout(()=>t.className=t.className.replace("show",""),3000); }

        let totalWater = 0;
        let goal = 2000;
        let records = [];

        document.addEventListener('DOMContentLoaded', () => {
            // å¾ Profile è®€å–é«”é‡ä¾†è¨ˆç®—ç›®æ¨™ (é«”é‡ x 30)
            const w = localStorage.getItem('profileWeight');
            if(w) goal = Math.round(w * 30);
            document.getElementById('goal-display').textContent = goal;

            // è®€å–ç´€éŒ„
            records = JSON.parse(localStorage.getItem('waterRecords') || '[]');
            // åªç¯©é¸ä»Šå¤©çš„
            const today = new Date().toLocaleDateString();
            records = records.filter(r => r.date === today);
            
            calculateTotal();
        });

        function addWater(amount) {
            records.push({ id: Date.now(), amount: amount, date: new Date().toLocaleDateString(), time: new Date().toLocaleTimeString() });
            saveAndRender();
            showToast(`Added ${amount}ml`);
        }

        function addCustomWater() {
            const val = parseInt(document.getElementById('custom-amount').value);
            if(!val || val <= 0) return showToast('Invalid amount');
            addWater(val);
            document.getElementById('custom-amount').value = '';
        }

        function resetWater() {
            if(confirm('Reset today\'s water?')) {
                records = [];
                saveAndRender();
            }
        }

        function saveAndRender() {
            // æ›´æ–°å…¨åŸŸè¨˜éŒ„
            let allRecords = JSON.parse(localStorage.getItem('waterRecords') || '[]');
            // ç§»é™¤ä»Šå¤©çš„èˆŠè³‡æ–™
            const today = new Date().toLocaleDateString();
            allRecords = allRecords.filter(r => r.date !== today);
            // åŠ å…¥æ–°çš„
            allRecords = allRecords.concat(records);
            
            localStorage.setItem('waterRecords', JSON.stringify(allRecords));
            calculateTotal();
        }

        function calculateTotal() {
            totalWater = records.reduce((sum, r) => sum + r.amount, 0);
            localStorage.setItem('totalWater', totalWater); // çµ¦ Dashboard ç”¨

            // Update UI
            const pct = Math.min(100, (totalWater / goal) * 100);
            document.getElementById('cupWater').style.height = `${pct}%`;
            document.getElementById('progressText').textContent = `${Math.round(pct)}%`;
            
            if(totalWater >= goal) {
                document.getElementById('remained').innerHTML = '<span style="font-size:1.2em;">Goal Reached!</span>';
            } else {
                const rem = goal - totalWater;
                document.getElementById('liters').textContent = `${rem / 1000}L`;
            }

            // Render list (å·²ä¿®æ­£é€™è£¡çš„èªæ³•éŒ¯èª¤)
            const list = document.getElementById('water-log');
            list.innerHTML = '';
            records.slice().reverse().forEach(r => {
                const div = document.createElement('div');
                div.style.padding = '8px';
                div.style.borderBottom = '1px solid #eee';
                div.style.display = 'flex';
                div.style.justify-content = 'space-between';
                // âš ï¸ ä¿®æ­£é‡é»ï¼šé€™è£¡ä½¿ç”¨äº†åå¼•è™Ÿ ` ` åŒ…è£¹ HTML å­—ä¸²
                div.innerHTML = `<span>${r.amount} ml</span> <small style="color:#999">${r.time}</small>`;
                list.appendChild(div);
            });
        }
    </script>
</body>
</html>